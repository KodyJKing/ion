(function(){require.register('ion/reactive/Operation',function(module,exports,require){// Generated by CoffeeScript 1.6.3
(function() {
  var Construct, Operation, getOperation, key, ops, properties;

  Construct = require('./Construct');

  module.exports = Operation = (function() {
    function Operation(properties) {
      Object.merge(this, properties);
    }

    Operation.prototype.format = function _format(a, b) {
      return "" + a + " " + this.op + " " + b;
    };

    Operation.prototype.toString = function _toString() {
      return this.op;
    };

    Operation.prototype.runtime = './OperationExpression';

    Operation.prototype.createRuntime = function _createRuntime(context, args) {
      var type;
      type = require(this.runtime);
      return new type({
        operation: this,
        context: context,
        args: args
      });
    };

    return Operation;

  })();

  ops = {
    "add": {
      addIndex: true,
      runtime: './AddStatement'
    },
    "block": {
      runtime: './BlockStatement'
    },
    "set": {
      newOutputContext: true,
      runtime: './AssignmentStatement'
    },
    "if": {
      runtime: './IfStatement'
    },
    "for": {
      runtime: './ForStatement'
    },
    "var": {
      statement: true
    },
    "ref": {},
    "children": {},
    "call": {},
    "array": {},
    "object": {},
    "predicate": {
      newInputContext: true,
      runtime: './NewContextExpression',
      evaluate : function _evaluate(left, right) {
        if (right) {
          return left;
        } else {
          return void 0;
        }
      }
    },
    "local": {
      newInputContext: true,
      runtime: './NewContextExpression',
      evaluate : function _evaluate(left, right) {
        return right;
      }
    },
    "member": {
      newInputContext: true,
      runtime: './NewContextExpression',
      observeLeftValue: true,
      evaluate : function _evaluate(left, right) {
        var value;
        value = left != null ? left[right] : void 0;
        if (typeof value === 'function') {
          value = value.bind(left);
        }
        return value;
      }
    },
    "*": {
      evaluate : function _evaluate(left, right) {
        return left * right;
      }
    },
    "/": {
      evaluate : function _evaluate(left, right) {
        return left / right;
      }
    },
    "%": {
      evaluate : function _evaluate(left, right) {
        return left % right;
      }
    },
    "+": {
      evaluate : function _evaluate(left, right) {
        return left + right;
      }
    },
    "-": {
      evaluate : function _evaluate(left, right) {
        return left - right;
      }
    },
    "&&": {
      evaluate : function _evaluate(left, right) {
        return left && right;
      }
    },
    "||": {
      evaluate : function _evaluate(left, right) {
        return left || right;
      }
    },
    "root": {
      evaluate: (function() {
        var getRoot;
        getRoot = function _getRoot(context) {
          if (context.parent != null) {
            return getRoot(context.parent);
          } else {
            return context.input;
          }
        };
        return function() {
          return getRoot(this);
        };
      })()
    },
    "ancestor": {
      evaluate : function _evaluate(delta) {
        var context;
        context = this;
        while (delta > 0 && (context != null)) {
          context = context.parent;
          delta--;
        }
        return context.input;
      }
    }
  };

  for (key in ops) {
    properties = ops[key];
    properties.op = key;
    Operation[key] = new Operation(properties);
  }

  Operation.getOperation = getOperation = function _getOperation(op) {
    var operation;
    operation = Operation[op];
    if (operation == null) {
      throw new Error("Operation not found " + op);
    }
    return operation;
  };

  Operation.createRuntimes = function _createRuntimes(context, astArray) {
    return astArray.map(function(arg) {
      return Operation.createRuntime(context, arg);
    });
  };

  Operation.createRuntime = function _createRuntime(context, ast) {
    var op, operation;
    op = ast != null ? ast.op : void 0;
    if (op == null) {
      return new (require('./StaticExpression'))({
        value: ast
      });
    }
    operation = getOperation(op);
    return operation.createRuntime(context, ast.args);
  };

}).call(this);

})})()