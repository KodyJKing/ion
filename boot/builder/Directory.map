{"version":3,"sources":["Directory.ion"],"names":["global","Window","ion","fs","np","utility","watcher","File","Directory","constructor","path","String","properties","exists","get",{"type":"Identifier","name":"get","loc":{"start":{"line":20,"column":12,"fixed":true},"end":{"line":20,"column":15,"fixed":true}}},"existsSync","toString","hasOwnProperty","getAbsoluteName","read","set","content","console","log","write","encoding","delete","getFile","getDirectory","getRelativeName","relative","join","search","include","exclude","options","initial","results","makeReactive","unwatch","watchDirectory","filename","checkForChanges","files","list"],"mappings":"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","sourcesContent":["\r\nif global.Window\r\n    return\r\n\r\nconst\r\n    ion = import '../'\r\n    fs = import 'fs'\r\n    np = import 'path'\r\n    utility = import './utility'\r\n    watcher = import './watcher'\r\n    File = import './File'\r\n\r\nexport class Directory\r\n    constructor: (path) ->\r\n        if path?\r\n            @path = String(path)\r\n    properties:\r\n        exists:\r\n            # exists is not reactive\r\n            get: -> fs.existsSync(@path)\r\n        path: '.'\r\n        toString: -> @path\r\n        get: (path) ->\r\n            # allow us to get our own properties\r\n            if @hasOwnProperty(path) or @[path]?\r\n                return @[path]\r\n\r\n            path = @getAbsoluteName(path)\r\n            if fs.existsSync(path)\r\n                return utility.read(path)\r\n            else\r\n                return undefined\r\n        set: (path, content) ->\r\n            if @hasOwnProperty(path) or @[path]?\r\n                return @[path] = content\r\n\r\n            path = @getAbsoluteName(path)\r\n            if content?\r\n                console.log(\"Writing: \" + path)\r\n            else\r\n                console.log(\"Deleting: \" + path)\r\n            utility.write(path, content)\r\n            return content\r\n        read: (path) ->\r\n            # allow us to get our own properties\r\n            if @hasOwnProperty(path) or @[path]?\r\n                return @[path]\r\n\r\n            path = @getAbsoluteName(path)\r\n            if fs.existsSync(path)\r\n                return utility.read(path)\r\n            else\r\n                return undefined\r\n        write: (path, content, encoding) ->\r\n            if not content?\r\n                return\r\n            if @hasOwnProperty(path) or @[path]?\r\n                return @[path] = content\r\n\r\n            path = @getAbsoluteName(path)\r\n            console.log(\"Writing: \" + path)\r\n            utility.write(path, content, encoding)\r\n        delete: (path) ->\r\n            console.log(\"Deleting: \" + path)\r\n            path = @getAbsoluteName(path)\r\n            utility.write(path, null)\r\n        getFile: (path) -> new File(@getAbsoluteName(path))\r\n        getDirectory: (path) -> new Directory(@getAbsoluteName(path))\r\n        getRelativeName: (path) -> np.relative(@path, String(path))\r\n        getAbsoluteName: (path) -> np.join(@path, String(path))\r\n        search: (include, exclude, options) ->\r\n            options ?=\r\n                initial: false\r\n            if include?\r\n                options.include = include\r\n            if exclude?\r\n                options.exclude = exclude\r\n            let results = {}\r\n            ion.makeReactive(\r\n                results\r\n                =>\r\n                    let unwatch = watcher.watchDirectory(\r\n                        @path\r\n                        options\r\n                        (filename) =>\r\n                            let path = @getRelativeName(filename)\r\n                            if fs.existsSync(filename)\r\n                                if not results[path]?\r\n                                    results[path] = new File(filename)\r\n                            else\r\n                                delete results[path]\r\n                            # explicit check is only because current\r\n                            # nodejs versions don't have Object.observe yet.\r\n                            ion.checkForChanges()\r\n                    )\r\n                    return unwatch\r\n            )\r\n            let files = utility.list(@path, options)\r\n            for path in files\r\n                results[@getRelativeName(path)] = new File(path)\r\n            return results\r\n\r\n\r\n\r\n"]}