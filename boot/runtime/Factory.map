{"version":3,"sources":["Factory.ion"],"names":["ion","Literal","Expression","Factory","properties","runtime","createRuntime","writable","value",{"type":"Identifier","name":"value","loc":{"start":{"line":12,"column":12,"fixed":true,"source":"ion/runtime/Factory.ion"},"end":{"line":12,"column":17,"fixed":true,"source":"ion/runtime/Factory.ion"}}},"context","ast","clone","factory","type","toCode","left","operator","right","JSON","stringify","lookup","VariableDeclaration","ThisExpression","getVariable","Identifier","name","Function","Template","Property","IfStatement","BlockStatement","ReturnStatement","ObjectExpression","ArrayExpression","ExpressionStatement","ForOfStatement","ForInStatement","MemberExpression","computed","object","property","CallExpression","NewExpression","UnaryExpression","evaluate","a","ConditionalExpression","BinaryExpression","getFactory","step","key","values","nodeValue","next","constructor","code","_toCode","Object","defineProperty","Error","test"],"mappings":"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","sourcesContent":["const ion = import '../'\nconst Literal = import './Literal'\nconst Expression = import './Expression'\n\nclass Factory\n    properties:\n        runtime: './OperationExpression'\n        # creates a runtime construct from this operation\n        # with the specified context and AST node\n        createRuntime:\n            writable: true\n            value: (context, ast) ->\n                let properties = ion.clone(ast)\n                properties.context = context\n                properties.factory = @\n                let type = import @runtime\n                return new type(properties)\n        toCode:\n            writable: true\n            value: (ast) ->\n                if ast.type is 'BinaryExpression'\n                    return toCode(ast.left) + ast.operator + toCode(ast.right)\n                return \"({{JSON.stringify(ast)}})\"\n\nconst lookup =\n    type:\n        VariableDeclaration: new Factory\n            runtime: './VariableDeclaration'\n        ThisExpression: new Factory\n            createRuntime: (context, ast) -> context.getVariable('this')\n            toCode: (ast) -> 'this'\n        Identifier: new Factory\n            createRuntime: (context, ast) -> context.getVariable(ast.name)\n            toCode: (ast) -> ast.name\n        Function: new Factory\n            createRuntime: (context, ast) ->\n                let value = ast.value\n                if ast.context\n                    value = value(context)\n                return new Literal({value:value})\n        Template: new Factory\n            runtime: './Template'\n        Literal: new Factory\n            runtime: './Literal'\n            toCode: (ast) -> JSON.stringify(ast.value)\n        Property: new Factory\n            runtime: './Property'\n        IfStatement: new Factory\n            runtime: './IfStatement'\n        BlockStatement: new Factory\n            runtime: './BlockStatement'\n        ReturnStatement: new Factory\n            runtime: './ReturnStatement'\n        ObjectExpression: new Factory\n            runtime: './ObjectExpression'\n        ArrayExpression: new Factory\n            runtime: './ArrayExpression'\n        ExpressionStatement: new Factory\n            runtime: './ExpressionStatement'\n        ForOfStatement: new Factory\n            runtime: './ForInOfStatement'\n        ForInStatement: new Factory\n            runtime: './ForInOfStatement'\n        MemberExpression: new Factory\n            runtime: './MemberExpression'\n            toCode: (ast) ->\n                if ast.computed\n                    return \"{{toCode(ast.object)}}[{{toCode(ast.property)}}]\"\n                else\n                    return \"{{toCode(ast.object)}}.{{toCode(ast.property)}}\"\n        CallExpression: new Factory\n            runtime: './CallExpression'\n        NewExpression: new Factory\n            runtime: './CallExpression'\n        UnaryExpression:\n            operator:\n                \"!\": new Factory\n                    evaluate: (a) -> not a\n                \"typeof\": new Factory\n                    evaluate: (a) -> typeof a\n                \"void\": new Factory\n                    evaluate: (a) -> void a\n                \"-\": new Factory\n                    evaluate: (a) -> - a\n                \"+\": new Factory\n                    evaluate: (a) -> + a\n                \"~\": new Factory\n                    evaluate: (a) -> ~ a\n                \"?\": new Factory\n                    evaluate: (a) -> a?\n        ConditionalExpression: new Factory\n            runtime: './ConditionalExpression'\n            # unlike in imperative code, both consequent and alternate are always evaluated\n            # evaluate: (test, consequent, alternate) -> test ? consequent : alternate\n        BinaryExpression:\n            operator:\n                \"*\": new Factory\n                    evaluate: (left, right) -> left * right\n                \"/\": new Factory\n                    evaluate: (left, right) -> left / right\n                \"%\": new Factory\n                    evaluate: (left, right) -> left % right\n                \"+\": new Factory\n                    evaluate: (left, right) -> left + right\n                \"-\": new Factory\n                    evaluate: (left, right) -> left - right\n                \"&&\": new Factory\n                    evaluate: (left, right) -> left and right\n                \"||\": new Factory\n                    evaluate: (left, right) -> left or right\n                \"&\": new Factory\n                    evaluate: (left, right) -> left & right\n                \"|\": new Factory\n                    evaluate: (left, right) -> left | right\n                \"==\": new Factory\n                    evaluate: (left, right) -> `left == right`\n                \"!=\": new Factory\n                    evaluate: (left, right) -> `left != right`\n                \"===\": new Factory\n                    evaluate: (left, right) -> left is right\n                \"!==\": new Factory\n                    evaluate: (left, right) -> left isnt right\n                \"<\": new Factory\n                    evaluate: (left, right) -> left < right\n                \">\": new Factory\n                    evaluate: (left, right) -> left > right\n                \"<=\": new Factory\n                    evaluate: (left, right) -> left <= right\n                \">=\": new Factory\n                    evaluate: (left, right) -> left >= right\n\nconst getFactory(ast, step = lookup) ->\n    for key, values of step\n        let nodeValue = ast[key]\n        let next = values[nodeValue]\n        if next?\n            if next.constructor is Factory\n                return next\n            return getFactory(ast, next)\n    return null\n\nexport const\n    toCode = (ast) ->\n        let code = ast._toCode\n        if not code?\n            let factory = getFactory(ast)\n            if factory?\n                code = factory.toCode(ast)\n            else\n                code = JSON.stringify(ast)\n            if typeof ast is 'object'\n                Object.defineProperty(ast, '_toCode', {value:code})\n        return code\n    createRuntime = (context, ast) ->\n        if typeof ast?.type isnt 'string'\n            ast =\n                type: 'Literal'\n                value: ast\n        let factory = getFactory(ast)\n        if not factory?\n            throw new Error(\"Factory not found for ast:\\n{{JSON.stringify(ast, null, '  ')}}\")\n        return factory.createRuntime(context, ast)\n    test = ->\n        # try to get a factory for < operation\n        let factory = getFactory(\n            {}\n                type: 'BinaryExpression'\n                operator: '>'\n                left:\n                    type: 'Literal'\n                    value: 1\n                right:\n                    type: 'Literal'\n                    value: 2\n        )\n        assert factory is lookup.type.BinaryExpression.operator[\">\"]\n        assert lookup.type.BinaryExpression.operator[\">\"]?\n"]}