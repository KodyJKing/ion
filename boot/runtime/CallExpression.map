{"version":3,"sources":["CallExpression.ion"],"names":["ion","DynamicExpression","ArrayExpression","args","activate",{"type":"Identifier","name":"activate","loc":{"start":{"line":9,"column":8,"fixed":true},"end":{"line":9,"column":16,"fixed":true}}},"calleeExpression","context","createRuntime","callee","watch","calleeWatcher","value","calleeValue","thisArg","objectExpression","unobserve","thisarg","thisObserver","template","observe","changes","evaluate","argumentExpressions","type","elements","arguments","observeElements","argumentWatcher","argumentsValue","deactivate","unwatch","templateWatcher","_evaluateInternal","isActive","apply","setValue","bind","create","DEBUG","e","console","error","stack","CallExpression","properties","module","exports"],"mappings":"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","sourcesContent":["const\r\n    ion = import '../'\r\n    DynamicExpression = import './DynamicExpression'\r\n    ArrayExpression = import './ArrayExpression'\r\n\r\nmodule.exports = class CallExpression extends DynamicExpression\r\n    properties:\r\n        args: null\r\n        activate: ->\r\n            super\r\n            @calleeExpression ?= @context.createRuntime(@callee)\r\n            @calleeExpression.watch(\r\n                @calleeWatcher ?= (value) =>\r\n                    @calleeValue = value\r\n                    # get thisArg and watch for changes\r\n                    let thisArg = @calleeExpression.objectExpression?.value\r\n                    if thisArg isnt @thisArg\r\n                        ion.unobserve(@thisarg, @thisObserver)\r\n                        @thisArg = thisArg\r\n                        if not @calleeValue?.template # we don't need to watch the thisArg if the callee is a template\r\n                            ion.observe(\r\n                                thisArg\r\n                                @thisObserver ?= (changes) =>\r\n                                    @evaluate()\r\n                            )\r\n                    @evaluate()\r\n            )\r\n            @argumentExpressions ?= @context.createRuntime({type:'ArrayExpression',elements:@arguments, observeElements:not @calleeValue?.template})\r\n            @argumentExpressions.watch(\r\n                @argumentWatcher ?= (value) =>\r\n                    @argumentsValue = value\r\n                    @evaluate()\r\n            )\r\n        deactivate: ->\r\n            super\r\n            @calleeExpression.unwatch(@calleeWatcher)\r\n            @argumentExpressions.unwatch(@argumentWatcher)\r\n            if @template?\r\n                @template.unwatch(@templateWatcher)\r\n                delete @template\r\n        _evaluateInternal: ->\r\n            if not (@isActive and @calleeValue? and @argumentsValue?)\r\n                return\r\n            let value = undefined\r\n            if @calleeValue.template\r\n                if @template?\r\n                    @template.unwatch(@templateWatcher)\r\n                # always use new on templates\r\n                @template = @calleeValue.apply(@thisArg, @argumentsValue)\r\n                @template.watch(@templateWatcher ?= @setValue.bind(@))\r\n            else\r\n                if @type is 'NewExpression'\r\n                    # create a new with variable args\r\n                    value = ion.create(@calleeValue, @argumentsValue)\r\n                else # @type is 'CallExpression'\r\n                    value = @calleeValue.apply(@thisArg, @argumentsValue)\r\n                @setValue(value)\r\n        if DEBUG\r\n            evaluate: ->\r\n                try\r\n                    @_evaluateInternal()\r\n                catch e\r\n                    # if we don't catch the errors, they might not be logged when occuring in an Object.observe callback\r\n                    console.error(e.stack ? e)\r\n        else\r\n            evaluate: -> @_evaluateInternal()\r\n"]}