{"version":3,"sources":["index.ion"],"names":["ion","primitive","string","number","boolean","function","isPrimitive",{"type":"Identifier","name":"isPrimitive","loc":{"start":{"line":7,"column":4,"fixed":true},"end":{"line":7,"column":15,"fixed":true}}},"object","normalizeProperty","property","writable","value","Array","isArray","get","set","hasOwnProperty","normalizeProperties","properties","name","variableArgConstructs","type","a","nodeObserveShim","Object","observe","checkForChanges","createShim","isObjectObservable","Node","global","NodeList","patch","mergePatch","merge","key","create","args","length","template","fn","createRuntime","ast","Context","context","setVariable","nextTick","process","setTimeout","clone","deep","item","constructor","observer","console","tryWrapper","changes","error","addEventListener","onObserved","unobserve","removeEventListener","unObserved","bind","thisArg","newFn","id","add","container","remove","originalItem","apply","arguments","nodeType","JSON","stringify","document","createTextNode","appendChild","removeChild","push","lastIndexOf","removeAt","index","splice","onAdded","onRemoved","defineProperties","defineClass","definitions","classDefinition","super","match","Error","classFunction","eval","canSetClassProperty","descriptor","getOwnPropertyDescriptor","types","Set","i","definition","prototype","deleteUndefined","k","v","onSet","is","instance","makeReactive","activate","observeCount","deactivate","call","serialize","deserialize","extractType","typeKey","typeName","serializable","parse","typedObject","test","Foo","getValue","result","f","b","s","window"],"mappings":"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","sourcesContent":["const ion = null # shouldn't depend on itself\r\n\r\nimport './es6'\r\n\r\nconst\r\n    primitive = {string:true,number:true,boolean:true,function:true}\r\n    isPrimitive = (object) -> not object? or primitive[typeof object] or false\r\n    normalizeProperty = (property) ->\r\n        if typeof property is 'function'\r\n            property =\r\n                writable: false\r\n                value: property\r\n        else if isPrimitive(property) or Array.isArray(property)\r\n            property =\r\n                value: property\r\n\r\n        if not property.get? and not property.set? and not property.hasOwnProperty('value')\r\n            property.value = undefined\r\n\r\n        if property.hasOwnProperty('value')\r\n            property.writable ?= true\r\n\r\n        return property\r\n    normalizeProperties = (properties = {}) ->\r\n        for name, property of properties\r\n            properties[name] = normalizeProperty(property)\r\n        return properties\r\n    variableArgConstructs = []\r\n        (type, a) -> new type()\r\n        (type, a) -> new type(a[0])\r\n        (type, a) -> new type(a[0], a[1])\r\n        (type, a) -> new type(a[0], a[1], a[2])\r\n        (type, a) -> new type(a[0], a[1], a[2], a[3])\r\n        (type, a) -> new type(a[0], a[1], a[2], a[3], a[4])\r\n        (type, a) -> new type(a[0], a[1], a[2], a[3], a[4], a[5])\r\n        (type, a) -> new type(a[0], a[1], a[2], a[3], a[4], a[5], a[6])\r\n        (type, a) -> new type(a[0], a[1], a[2], a[3], a[4], a[5], a[6], a[7])\r\n        (type, a) -> new type(a[0], a[1], a[2], a[3], a[4], a[5], a[6], a[7], a[8])\r\n        (type, a) -> new type(a[0], a[1], a[2], a[3], a[4], a[5], a[6], a[7], a[8], a[9])\r\n    nodeObserveShim = Object.observe?.checkForChanges ? Object : import('./es6/Object.observe').createShim()\r\n    isObjectObservable = do ->\r\n        let Node = global.Node ? ->\r\n        let NodeList = global.NodeList ? ->\r\n        return (a) ->\r\n            if a instanceof Node or a instanceof NodeList\r\n                return false\r\n            return true\r\n\r\nexport const\r\n    patch = do ->\r\n        let mergePatch = import './mergePatch'\r\n        let patch = (object, patch) -> mergePatch.merge(object, patch)\r\n        for key, value of mergePatch\r\n            patch[key] = value\r\n        return patch\r\n    create = (type, args) -> variableArgConstructs[args.length](type, args)\r\n    template = (fn, template) ->\r\n        fn.template = template\r\n        return fn\r\n    createRuntime = (ast, args) ->\r\n        const Context = import './runtime/Context'\r\n        const context = new Context()\r\n        if args?\r\n            for name, value of args\r\n                context.setVariable(name, value)\r\n        return context.createRuntime(ast)\r\n    nextTick = @process?.nextTick ? (fn) -> setTimeout(fn, 0)\r\n    clone = (object, deep = false) ->\r\n        if Array.isArray(object)\r\n            return [deep ? clone(item, deep) : item for item in object]\r\n        else if object?.constructor is Object\r\n            return {}\r\n                for key, value of object\r\n                    [key]: deep ? clone(value, deep) : value\r\n        else\r\n            return object\r\n    observe = (object, observer, property) ->\r\n        if object is global or object is console\r\n            return\r\n        # property is optional\r\n        if not isObjectObservable(object)\r\n            if not property?\r\n                return\r\n            nodeObserveShim.observe(object, observer, property)\r\n        else if object? and observer? and Object.observe? and typeof object is 'object'\r\n            observer.tryWrapper ?= (changes) ->\r\n                try\r\n                    observer(changes)\r\n                catch error\r\n                    console.error('Exception in Object.observe callback', error)\r\n            Object.observe(object, observer.tryWrapper)\r\n            # watch change on dom elements\r\n            object.addEventListener?('change', observer)\r\n        object?.onObserved?(observer, property)\r\n    unobserve = (object, observer, property) ->\r\n        # property is optional\r\n        if not isObjectObservable(object)\r\n            if not property?\r\n                return\r\n            nodeObserveShim.unobserve(object, observer, property)\r\n        else if object? and observer? and Object.unobserve? and typeof object is 'object'\r\n            Object.unobserve(object, observer.tryWrapper ? observer)\r\n            # unwatch change on dom elements\r\n            object.removeEventListener?('change', observer)\r\n        object?.unObserved?(observer, property)\r\n    checkForChanges = ->\r\n        if Object.observe.checkForChanges?\r\n            Object.observe.checkForChanges()\r\n        else\r\n            nodeObserveShim.observe.checkForChanges()\r\n    bind = (fn, thisArg) ->\r\n        let newFn = fn.bind(thisArg)\r\n        # the function name has semantic meaning for us when adding a function to an element\r\n        # (see add function below)\r\n        # so we copy the function name to the new bound function id property when binding\r\n        # (function.name is readonly)\r\n        if fn.name?.length > 0\r\n            newFn.id = fn.id ? fn.name\r\n        return newFn\r\n    add = (container, item) ->\r\n        let remove\r\n        if typeof item is 'function' and (item.name?.length > 0 or item.id?) and typeof container.addEventListener is 'function'\r\n            let name = item.id ? item.name\r\n            # if this platform doesn't have native Object.observe\r\n            # then we wrap all event handlers and call checkForChanges after\r\n            if Object.observe?.checkForChanges?\r\n                let originalItem = item\r\n                item = ->\r\n                    originalItem.apply(@, arguments)\r\n                    Object.observe.checkForChanges()\r\n            container.addEventListener(name, item)\r\n            remove = ->\r\n                container.removeEventListener(name, item)\r\n        else if container.nodeType is 1\r\n            if typeof item isnt 'string' and not item.nodeType?\r\n                item = JSON.stringify(item)\r\n            if typeof item is 'string'\r\n                item = document.createTextNode(item)\r\n            container.appendChild(item)\r\n            remove = ->\r\n                container.removeChild(item)\r\n        else\r\n            if container.push?\r\n                container.push(item)\r\n            else\r\n                container.add(item)\r\n            remove = ->\r\n                if container.lastIndexOf? and container.removeAt?\r\n                    let index = container.lastIndexOf(item)\r\n                    if index >= 0\r\n                        container.removeAt(index)\r\n                else if typeof container.remove is 'function'\r\n                    container.remove(item)\r\n                else if Array.isArray(container)\r\n                    let index = container.lastIndexOf(item)\r\n                    if index >= 0\r\n                        container.splice(index, 1)\r\n\r\n        item?.onAdded?(container)\r\n        # returns a function which can be used to remove the item\r\n        return ->\r\n            remove()\r\n            item?.onRemoved?(container)\r\n    defineProperties = (object, properties) -> Object.defineProperties(object, normalizeProperties(properties))\r\n    defineClass = (...definitions) ->\r\n        const classDefinition = definitions[0]\r\n        if definitions[1] is undefined\r\n            # extend our base object by default unless user sets extends to null explicitly.\r\n            definitions[1] = import './Object'\r\n        classDefinition.super = definitions[1]\r\n        const name = classDefinition.name ? classDefinition.id?.match(/([a-z_0-9\\$]+)(\\.js)?$/i)?[1]\r\n        if not name?\r\n            throw new Error('missing name property')\r\n        let classFunction\r\n        if classDefinition.hasOwnProperty('constructor')\r\n            classFunction = classDefinition.constructor\r\n        else if classDefinition.super?\r\n            classFunction = eval(\"(function {{name}}() { {{name}}.super.apply(this, arguments); })\")\r\n        else\r\n            classFunction = eval(\"(function {{name}}() {})\")\r\n\r\n        # successively merge patch the definitions onto the new class\r\n        let canSetClassProperty = (key) ->\r\n            if key is 'name'\r\n                return false\r\n            let descriptor = Object.getOwnPropertyDescriptor(classFunction, key)\r\n            return not descriptor? or descriptor.writable or not descriptor.get?\r\n\r\n        let types = new Set()   # a map of all types\r\n        types.add(classFunction)\r\n        for let i = definitions.length - 1; i >= 0; i--\r\n            let definition = definitions[i]\r\n            if definition?\r\n                types.add(definition)\r\n                for key, value of definition if key isnt 'test' or i is 0\r\n                    if canSetClassProperty(key)\r\n                        classFunction[key] = patch(classFunction[key], value)\r\n        classFunction.types = types\r\n\r\n        if classFunction.properties?\r\n            defineProperties(classFunction.prototype, classFunction.properties)\r\n\r\n        return classFunction\r\n    get = (object, property) ->\r\n        if not (object? and property?)\r\n            return undefined\r\n        if object isnt @ and typeof object.get is 'function'\r\n            return object.get(property)\r\n        else\r\n            return object[property]\r\n    set = (object, property, value, deleteUndefined = true) ->\r\n        # console.log('ion.set', property, value)\r\n        if object?\r\n            if arguments.length is 2 and property?\r\n                # set all properties\r\n                for k, v of property\r\n                    set(object, k, v)\r\n                return\r\n\r\n            if object isnt @ and typeof object.set is 'function'\r\n                object.set(property, value)\r\n            else if deleteUndefined and value is undefined\r\n                delete object[property]\r\n            else\r\n                object[property] = value\r\n            # we will notify an object when it is set on another object\r\n            # if the object has an onSet \r\n            value?.onSet?(object, property)\r\n        return value\r\n    is = (instance, type) ->\r\n        if not instance?\r\n            return false\r\n        if not type?\r\n            return true\r\n        if typeof type is 'function'\r\n            if typeof instance.is is 'function'\r\n                return instance.is(type)\r\n            return instance instanceof type\r\n        else\r\n            return instance is type\r\n    makeReactive = (object, activate) ->\r\n        let observeCount = 0\r\n        let deactivate = null\r\n        return Object.defineProperties(\r\n            object\r\n            {}\r\n                onObserved:\r\n                    value: ->\r\n                        observeCount++\r\n                        if observeCount is 1\r\n                            deactivate = activate.call(object)\r\n                unObserved:\r\n                    value: ->\r\n                        observeCount--\r\n                        if observeCount is 0\r\n                            deactivate?()\r\n        )\r\n    serialize = (object) -> JSON.stringify(object)\r\n    deserialize = do ->\r\n        let extractType = (object) ->\r\n            let typeKey = import('ion/Object').typeKey\r\n            # we should strongly type our objects when created, so make a factory\r\n            let typeName = object[typeKey]\r\n            if not typeName?\r\n                return Object\r\n            let type = import(typeName)\r\n            if not type.serializable\r\n                throw new Error(\"Type is not serializable: {{ typeName }}\")\r\n            # remove the type field from the source object\r\n            delete object[typeKey]\r\n            return type\r\n        let deserialize = (object) ->\r\n            if typeof object is 'string'\r\n                object = JSON.parse(object)\r\n            let typeKey = import('ion/Object').typeKey\r\n            # we should strongly type our objects when created, so make a factory\r\n            let typeName = object[typeKey]\r\n            if typeName?\r\n                let type = import(typeName)\r\n                if not type.serializable\r\n                    throw new Error(\"Type is not serializable: {{ typeName }}\")\r\n                let typedObject = new type\r\n                for key, value of object if key isnt typeKey\r\n                    typedObject[key] = object[key]\r\n                return typedObject\r\n            else\r\n                return object\r\n        deserialize.extractType = extractType\r\n        return deserialize\r\n    test =\r\n        defineClass: ->\r\n            const Foo = defineClass(\r\n                {}\r\n                    id: \"Foo\"\r\n                    constructor: (number) ->\r\n                        @number = number\r\n                    properties:\r\n                        getValue: -> @number\r\n            )\r\n            assert new Foo(2).getValue() is 2\r\n        defineProperties:\r\n            \"should allow primitive values\": ->\r\n                const object = {}\r\n                const result = defineProperties(\r\n                    object\r\n                    {}\r\n                        f: -> \"function\"\r\n                        i: 2\r\n                        b: true\r\n                        a: []\r\n                        s: \"hello\"\r\n                )\r\n                assert object is result\r\n                assert typeof object.f is 'function'\r\n                assert object.f() is 'function'\r\n                assert object.i is 2\r\n                assert object.b is true\r\n                assert Array.isArray(object.a)\r\n                assert object.s is 'hello'\r\n\r\n# if window, then on resize, check for changes\r\nif global.window?\r\n    global.window.addEventListener(\r\n        'resize'\r\n        ->\r\n            checkForChanges()\r\n    )\r\n"]}