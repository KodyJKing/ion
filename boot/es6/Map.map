{"version":3,"sources":["Map.ion"],"names":["uniqueCounter","idName","getId",{"type":"Identifier","name":"getId","loc":{"start":{"line":7,"column":6,"fixed":true},"end":{"line":7,"column":11,"fixed":true}}},"key","String","id","Object","defineProperty","value","enumerable","MapShim","pairs","Error","lookup","keys","methods","get","set","hasOwnProperty","push","has","delete","remove","clear","slice","forEach","callback","thisArg","call","global","Map","prototype","console","warn","test","map","length","mykey1","JSON","stringify"],"mappings":"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","sourcesContent":["# don't depend on ion for this.\r\n\r\n# the uniqueCounter and getId have to be defined outside of the MapShim constructor.\r\n# otherwise some objects may end up with the same uniqueId if they are added to different Maps.\r\nlet uniqueCounter = 0\r\nconst idName = \"__Map_id\"\r\nconst getId = (key) ->\r\n    if not key?\r\n        return String(key)\r\n    if typeof key is 'string' or typeof key is 'number' or typeof key is 'boolean'\r\n        return \"_\" + key\r\n    let id = key[idName]\r\n    if not id?\r\n        id = ++uniqueCounter\r\n        Object.defineProperty(key, idName, {value:id,enumerable:false})\r\n    return id\r\n\r\nconst MapShim(pairs) ->\r\n    if pairs?\r\n        throw new Error(\"Don't add items in the constructor, IE implementation of Set breaks this\")\r\n    let lookup = {}\r\n    let keys = []\r\n    const methods =\r\n        get: (key) -> lookup[getId(key)]\r\n        set: (key, value) ->\r\n            let id = getId(key)\r\n            if not lookup.hasOwnProperty(id)\r\n                keys.push(key)\r\n            lookup[id] = value\r\n            return value\r\n        has: (key) ->\r\n            let id = getId(key)\r\n            return lookup.hasOwnProperty(id)\r\n        delete: (key) ->\r\n            let id = getId(key)\r\n            keys.remove(key)\r\n            delete lookup[id]\r\n        clear: ->\r\n            lookup = {}\r\n            keys = []\r\n        keys: -> keys.slice(0)\r\n        forEach: (callback, thisArg) ->\r\n            for key in keys\r\n                let value = @get(key)\r\n                callback.call(thisArg, value, key, @)\r\n    for key, value of methods\r\n        Object.defineProperty(@, key, {value})\r\n\r\n# we will even replace Googles crap implementation of Map that doesn't yet have forEach or keys\r\nif not global.Map? or not Map.prototype.forEach?\r\n    console.warn('Shimming Map')\r\n    global.Map = MapShim\r\n# shim keys if not provided for Chrome.\r\nif not (new Map()).keys?\r\n    console.warn('Shimming Map.prototype.keys')\r\n    Map.prototype.keys = ->\r\n        let keys = []\r\n        @forEach(\r\n            (value, key) ->\r\n                keys.push(key)\r\n        )\r\n        return keys\r\n\r\nexport const test = ->\r\n    const Map = global.Map\r\n    let map = new Map()\r\n    map.set('a', 1)\r\n    map.set('b', 2)\r\n    assert Object.keys(map).length is 0\r\n    assert map.has('a')\r\n    assert not map.has('c')\r\n    assert map.get('a') is 1\r\n    assert map.get('b') is 2\r\n    assert map.get('c') is undefined\r\n    let mykey1 = {}\r\n    map.set(mykey1, \"one\")\r\n    assert Object.keys(mykey1).length is 0\r\n    assert map.get(mykey1) is \"one\"\r\n    assert JSON.stringify(map.keys()) is JSON.stringify(['a','b',mykey1])\r\n"]}