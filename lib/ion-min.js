// Generated by CoffeeScript 1.3.3
(function(){var e,t,n,r,i,s,o,u,a,f,l,c,h;t=function(){function e(e,t,n,r){this.symbol=e,this.type=t,this.text=n!=null?n:this.type,this.value=r}return e.prototype.toJSON=function(){return this.symbol?this.type:this.value},e.prototype.toString=function(){return this.text},e}(),h=[[/^\s*#.*/,function(e){return null}],[/^\s*\[/,function(e){return new t(!0,"[",e)}],[/^\s*\]/,function(e){return new t(!0,"]",e)}],[/^\s*:/,function(e){return new t(!0,":",e)}],[/^\s*,/,function(e){return new t(!0,",",e)}],[/^\s*"([^"\\]|(\\([\/'"\\bfnrt]|(u[a-fA-F0-9]{4}))))*"/,function(e){return new t(!1,"quoted",e,JSON.parse(e))}],[/^[^,:\[\]#]+/,function(e){return new t(!1,"unquoted",e,e.trim())}]],l=function(e){var t,n,r,i,s,o,u,a;if(e.trim().length===0)return null;s=[];while(e.trim().length>0){n=!1;for(u=0,a=h.length;u<a;u++){o=h[u],t=e.match(o[0]);if(t!=null){n=!0,i=o[1](r=t[0]),i!=null&&s.push(i),e=e.substring(r.length);break}}if(!n)throw new Error(e)}return s},e=function(){function e(e,t,n){var r,i,s,o;this.line=e,this.lineNumber=t,this.indent=n,e!=null&&(this.tokens=l(e),this.isText=u(this.tokens),((i=this.tokens)!=null?i.length:void 0)>=2&&!(r=this.tokens[0]).symbol&&this.tokens[1].type===":"&&(this.key=r.value),this.hasColon=this.key!=null||((s=this.tokens)!=null?(o=s[0])!=null?o.type:void 0:void 0)===":")}return e.prototype.error=function(e,t){var n;return n=new Error(""+e+", line:"+this.lineNumber),n.lineNumber=this.lineNumber,n.line=this.line,n},e.prototype.getAllDescendantLines=function(e,t){var n,r,i,s;e==null&&(e=[]),t==null&&(t=this.indent+1);if(this.children!=null){s=this.children;for(r=0,i=s.length;r<i;r++)n=s[r],e.push(n.line.substring(t)),n.getAllDescendantLines(e,t)}return e},e.prototype.getComplexType=function(e){var t,n,r,i,s,o,u,a,f,l,c;r=((f=this.tokens)!=null?f.length:void 0)>=3?(l=this.tokens)!=null?l.slice(2).join("").trim():void 0:void 0;if(r!=null)return e.explicit=!0,r;o=0,i=0,s={},n=!1,c=this.children;for(u=0,a=c.length;u<a;u++){t=c[u];if(t.isText&&!t.key||t.children!=null&&!t.hasColon)return'""';t.tokens&&(o++,t.key&&(i++,s[t.key]&&(n=!0),s[t.key]=!0))}if(n||o>0&&i===0)return"[]";if(i===o)return"{}";throw this.error("Inconsistent child keyCount")},e.prototype.getSimpleValue=function(e){var t,n,r;n=this.tokens;if(n.length===0)return void 0;this.key?n=n.slice(2):this.hasColon&&(n=n.slice(1));if(n.length===0)return null;if(n.length>=2&&n[0].type==="["&&n[n.length-1].type==="]"&&(r=s(n.slice(1,-1))))return r;if(!this.isText){if(n.length===1)return t=n[0],t.type==="quoted"&&(e.explicit=!0),t.value;if(r=s(n))return r}return n.join("").trim()},e.prototype.doChildrenHaveKeys=function(){var e,t,n,r;r=this.children;for(t=0,n=r.length;t<n;t++){e=r[t];if(e.key!=null)return!0}return!1},e.prototype.getComplexValue=function(e){var t,n,r,i,s,o,u,a,f,l,c;i=this.getComplexType(e);if(i==='""')s=this.getAllDescendantLines().join("\n");else if(i==="[]")if(this.doChildrenHaveKeys()){s=[],n=null,l=this.children;for(o=0,a=l.length;o<a;o++){t=l[o];if(!t.tokens)continue;r=t.key,(n===null||n.hasOwnProperty(r))&&s.push(n={}),n[r]=t.getValue()}}else s=function(){var e,n,r,i;r=this.children,i=[];for(e=0,n=r.length;e<n;e++)t=r[e],t.tokens&&i.push(t.getValue());return i}.call(this);else{s={},c=this.children;for(u=0,f=c.length;u<f;u++)t=c[u],t.tokens&&(s[t.key]=t.getValue())}return s},e.prototype.getValue=function(){var e,t;e={};if(this.children!=null){if(this.isText)throw this.children[0].error("Children not expected");t=this.getComplexValue(e)}else t=this.getSimpleValue(e);return typeof t=="string"&&!e.explicit&&(t=c(t)),t},e}(),c=function(e){var t,n,r,i,s;s=o.processors;for(r=0,i=s.length;r<i;r++){t=s[r],n=t(e);if(n!==void 0)return n}return e},u=function(e){var t,n,r,i,s;if(e){t=/[^\s\w]/;for(i=0,s=e.length;i<s;i++){n=e[i];if(n.type==="unquoted"){r=n.value;if(typeof r=="string"&&t.test(r))return!0}}}return!1},s=function(e){var t,n,r,i,s;for(t=i=0,s=e.length;i<s;t=++i){r=e[t];if(t%2===0){if(r.symbol)return null}else if(r.type!==",")return null}return function(){var t,r,i,s;i=[];for(t=0,r=e.length,s=2;t<r;t+=s)n=e[t],i.push(n.value);return i}()},a=function(t){var n,r,i,s,o,u,a;i=new e(null,null,-1),s=[i];for(o=0,u=t.length;o<u;o++){n=t[o];while(n.indent<=(r=s[s.length-1]).indent)s.pop();((a=r.children)!=null?a:r.children=[]).push(n),s.push(n)}return i},o={parse:function(t,n){var r,i,s,o,u,f,l,c,h,p,d,v;t=t.trim(),o=[],h=t.split("\r\n");for(i=l=0,c=h.length;l<c;i=++l){s=h[i];if(s.trim()[0]==="#")continue;r=(p=s.trim().length===0?r:r=(d=s.match(/^\s*/))!=null?(v=d[0])!=null?v.length:void 0:void 0)!=null?p:0,o.push(new e(s,i+1,r))}return u=a(o),f=u.getValue(),f},processors:[function(e){if(e.match(/^\s*null\s*$/))return null},function(e){if(e.match(/^\s*(true|false)\s*$/))return Boolean(e.trim())},function(e){if(e.match(/^\s*[0-9]+(\.[0-9]+)?([eE][-+]?[0-9]+)?\s*$/))return Number(e.trim())},function(e){if(e.match(/^\s*\d\d\d\d-\d\d-\d\d(T\d\d:\d\d(:\d\d(\.\d{1,3})?)?(Z|([+-]\d\d:\d\d))?)?\s*$/))return new Date(e.trim())},function(e){if(e.match(/^\s*{}\s*$/))return{}},function(t){var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E;h=t.split("\n");if(h.length>3&&h[0].match(/^([^: ]+( [^: ]+)*:( +|$)){2,}$/)){o=[],d=/[^: ]+( [^: ]+)*/g;while(p=d.exec(h[0]))o.push([(new e(p[0])).getValue(),p.index]);if(o.length>=2){n=[];for(u=g=1,w=h.length;1<=w?g<w:g>w;u=1<=w?++g:--g){c=h[u],n.push(f={});for(a=y=0,b=o.length;y<b;a=++y)s=o[a],l=s[0],v=s[1],i=(E=o[a+1])!=null?E[1]:void 0,r=c.substring(v,i),r.trim().length&&(m=(new e(r)).getValue(),f[l]=m)}return n}}}]};if(typeof module=="undefined")(function(){return this.ion=o})();else{module.exports=o;if(require.main===module){i=require("fs"),n=process.argv.slice(2);if(n.length===0)return console.log("Usage: ion file.ion");r=i.readFileSync(n[0],"utf8"),f=o.parse(r),console.log(JSON.stringify(f,null,"    "))}}}).call(this);